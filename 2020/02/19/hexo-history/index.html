<!DOCTYPE html>
<html lang="zh-Hans">
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="hexo history 插件开发">
    <meta name="keywords" content>
    <meta name="author">
    <meta name="copyright">
    <title>hexo history 插件开发 | luckyray</title><link rel="shortcut icon" href="/favicons.ico">
    <link rel="stylesheet" href="/css/index.css?version=1.6.1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1">
    <link rel="dns-prefetch" href="https://cdn.staticfile.org">
    <link rel="dns-prefetch" href="https://cdn.bootcss.com">
    <link rel="dns-prefetch" href="https://creativecommons.org">
    <script>
      var GLOBAL_CONFIG = {
        root: '/',
        algolia: undefined,
        localSearch: undefined,
        copy: {
          success: '复制成功',
          error: '复制错误',
          noSupport: '浏览器不支持'
        }
      }
    </script>
  </head>
  <body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i>
    <div id="sidebar">
      <div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span>
        <hr>
      </div>
      <div class="sidebar-toc">
        <div class="sidebar-toc__title">目录</div>
        <div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span>
          <div class="sidebar-toc__progress-bar"></div>
        </div>
        <div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#开端"><span class="toc-number">1.</span> <span class="toc-text">开端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#效果"><span class="toc-number">2.</span> <span class="toc-text">效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简介与发展"><span class="toc-number">3.</span> <span class="toc-text">简介与发展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写思路"><span class="toc-number">4.</span> <span class="toc-text">编写思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#建立整个项目的基础"><span class="toc-number">5.</span> <span class="toc-text">建立整个项目的基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#流程细节"><span class="toc-number">6.</span> <span class="toc-text">流程细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hexo-注册"><span class="toc-number">6.1.</span> <span class="toc-text">hexo 注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何在插件中使用-vue"><span class="toc-number">7.</span> <span class="toc-text">如何在插件中使用 vue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#骨架屏"><span class="toc-number">7.1.</span> <span class="toc-text">骨架屏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求方式"><span class="toc-number">7.2.</span> <span class="toc-text">请求方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#节点渲染"><span class="toc-number">7.3.</span> <span class="toc-text">节点渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#打包优化"><span class="toc-number">7.4.</span> <span class="toc-text">打包优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#超详细流程"><span class="toc-number">7.5.</span> <span class="toc-text">超详细流程</span></a></li></ol></li></ol></div>
      </div>
      <div class="author-info hide">
        <div class="author-info__avatar text-center"><img src="/img/avatar.png"></div>
        <div class="author-info__name text-center"></div>
        <div class="author-info__description text-center">只能自己努力找乐子了</div>
        <hr>
        <div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">25</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">8</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">6</span></a>
        </div>
      </div>
    </div>
    <div id="content-outer">
      <div id="top-container" style="background-image: url(http://img.luckyray.cn/896653.jpg)">
        <div id="page-header"><span class="pull-left"> <a id="site-name" href="/">luckyray</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div>
        <div id="post-info">
          <div id="post-title">hexo history 插件开发</div>
          <div id="post-meta">
            <time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-19
            </time>
          </div>
        </div>
      </div>
      <div class="layout" id="content-inner">
        <article id="post">
          <div class="article-container" id="post-content"><h2 id="开端"><a href="#开端" class="headerlink" title="开端"></a>开端</h2><p>因为写文章经常想要看看以前写的是啥, 又怎么改过来的, 所以编写了这个插件, 最早的想法起于十月</p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>右下角尝试一下就好</p>
<h2 id="简介与发展"><a href="#简介与发展" class="headerlink" title="简介与发展"></a>简介与发展</h2><p>最早时想的是能够对比出上一次文章的差异, 所以不知道自己想要什么效果, 执行的流程又是如何, 现在整个核心思想应该是<strong>展示旧文章是如何转变为新文章的</strong>, 通过删除, 新增, 更改来标注段落</p>
<p>但是到现在,只完成了能够查看以前写的是啥, 最想写的文章更改还差部分, 所以预计将会在面试结束前后完成</p>
<h2 id="编写思路"><a href="#编写思路" class="headerlink" title="编写思路"></a>编写思路</h2><p><strong>执行流程</strong></p>
<ul>
<li>hexo 注册函数</li>
<li>vue 挂载, 请求 github 得到内容</li>
<li>选择时间, 插入骨架屏到页面</li>
<li>在 iframe 中加载dom, 然后返回想要的 dom 节点</li>
<li>替换节点, 加载成功</li>
</ul>
<h2 id="建立整个项目的基础"><a href="#建立整个项目的基础" class="headerlink" title="建立整个项目的基础"></a>建立整个项目的基础</h2><p>找到了 <a href="https://github.com/pomber/git-history" target="_blank" rel="noopener">git-history</a> 项目, github 相关 api, 然后根据 <a href="https://github.com/EYHN/hexo-helper-live2d" target="_blank" rel="noopener">hexo-helper-live2d</a>, 了解了 hexo 注册方法, 此时正式开始</p>
<h2 id="流程细节"><a href="#流程细节" class="headerlink" title="流程细节"></a>流程细节</h2><h3 id="hexo-注册"><a href="#hexo-注册" class="headerlink" title="hexo 注册"></a>hexo 注册</h3><p>hexo 可以用 vscode debug, 具体可见 <a href="https://gary5496.github.io/2018/03/nodejs-debugging/" target="_blank" rel="noopener">hexo debug</a></p>
<blockquote>
<p>本来使用 after_render:html 参数基本解决插入脚本的问题, 可是想要只让 post 文章中才显示, 所以测试了filter 中的 after_post_render 参数, 在 issue 中了解到应该是新建一个 post 的时候才会调用, 又尝试了其他参数, 和 processor, renderer 等扩展注册, 都没法解决问题, 看来应该只能在执行的时候判断了,<strong>现在搁置</strong></p>
</blockquote>
<h2 id="如何在插件中使用-vue"><a href="#如何在插件中使用-vue" class="headerlink" title="如何在插件中使用 vue"></a>如何在插件中使用 vue</h2><ul>
<li>使用 <code>$mount</code> 动态挂载</li>
<li>使用 iview 省得手动写组件</li>
</ul>
<p><strong>遇到的问题</strong></p>
<ul>
<li>用 innerHTML 来替换节点, 发现渲染似乎不变, 改为 dom 节点替换</li>
</ul>
<h3 id="骨架屏"><a href="#骨架屏" class="headerlink" title="骨架屏"></a>骨架屏</h3><p>使用手写的骨架屏方式, 然后注入进去</p>
<p><strong>遇到的问题</strong></p>
<ul>
<li>希望能动态生成<ul>
<li>用 js 读取文字长度再转为像素, 设定几个div加上css</li>
<li>将 p 标签全部转为 span 等行内标签就可以自适应长度, 再用css显示</li>
<li>嫌麻烦, 就这样了<h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3></li>
</ul>
</li>
</ul>
<p>采用 fetch 请求, 就没必要写回调, 直接 await 清清楚楚, 同时有 sessionstorage, 存储下请求, 防止多次访问</p>
<h3 id="节点渲染"><a href="#节点渲染" class="headerlink" title="节点渲染"></a>节点渲染</h3><p>用 iframe 在内部挂载好事件监听load再返回, 力求一致</p>
<p><strong>遇到的问题</strong></p>
<ul>
<li><strong>!!!并未解决</strong>, 如果换了主题, 之前的资源文件都被删了, 该怎么办<ul>
<li>放到某个cdn上, 然后手动替换字符串</li>
<li>检测节点属性挂载</li>
</ul>
</li>
</ul>
<h3 id="打包优化"><a href="#打包优化" class="headerlink" title="打包优化"></a>打包优化</h3><ul>
<li>webpack 使用生产模式</li>
<li>vue 使用外部 cdn</li>
<li>可以把 iview css 分出来, 但没有这么做</li>
</ul>
<h3 id="超详细流程"><a href="#超详细流程" class="headerlink" title="超详细流程"></a>超详细流程</h3><p>从整个执行流程来看, 首先需要一个执行的</p>
<ul>
<li>hexo 注册函数, 移动js文件, 修改html文件内容</li>
<li>vue 挂载, 将组件插入文档中</li>
<li>在组件 mounted 时, 请求 github 当前页面的 commit 历史</li>
<li>解析 response, 请求 commit 的具体信息, 再根据具体信息找出当前页面的更改信息的url, 这次请求便可得到内容</li>
<li>base64 decode 获得最终想要的文档, 返回到组件 data 中的 items 属性, 此时组件开始渲染</li>
<li>选择想回到的时间, 插入骨架屏到页面</li>
<li>在 iframe 中加载dom, 然后返回想要的 dom 节点</li>
<li>替换节点, 加载成功</li>
</ul>
</div>
        </article>
        <div class="post-copyright">
          <div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined"></a></span></div>
          <div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://luckyray-fan.github.io/2020/02/19/hexo-history/">https://luckyray-fan.github.io/2020/02/19/hexo-history/</a></span></div>
          <div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://luckyray-fan.github.io">luckyray</a>！</span></div>
        </div>
        <div class="post-meta__tag-list">
        </div>
        <nav id="pagination">
          <div class="next-post pull-right"><a href="/2020/02/10/heckel-diff-algorithm-implemention/"><span>heckel-diff-algorithm-implemention</span><i class="fa fa-chevron-right"></i></a></div>
        </nav>
      </div>
    </div>
    <footer class="footer-bg" style="background-image: url(http://img.luckyray.cn/896653.jpg)">
      <div class="layout" id="footer">
        <div class="copyright">&copy;2019 - 2020 By null</div>
        <div class="framework-info"><span>驱动 - </span><a href="#"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="#"><span>diary</span></a></div>
      </div>
    </footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i>
    <script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script>
    <script src="/js/utils.js?version=1.6.1"></script>
    <script src="/js/fancybox.js?version=1.6.1"></script>
    <script src="/js/sidebar.js?version=1.6.1"></script>
    <script src="/js/copy.js?version=1.6.1"></script>
    <script src="/js/fireworks.js?version=1.6.1"></script>
    <script src="/js/transition.js?version=1.6.1"></script>
    <script src="/js/scroll.js?version=1.6.1"></script>
    <script src="/js/head.js?version=1.6.1"></script>
    <script>
      if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
        $('#nav').addClass('is-mobile')
        $('footer').addClass('is-mobile')
      }
    </script>
  <script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script> <script>window.hexoHistoryConfig = JSON.parse({"repo":"luckyray-fan/luckyray-fan.github.io","token":"1d5107f3e8a6dd270b60bb70ffce79485b387e53","theme":"melody"});</script> <script src="/hexo-history-main.js"></script></body>
</html>